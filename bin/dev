#!/usr/bin/env bash

# Helpers
dc () {
	docker-compose -f docker-compose.dev.yaml "$@"
}

function_exists () {
	declare -F "$1" > /dev/null
}

# Docker Compose overrides
build () {
	echo "not yet implemented"
}

up () {
	dc up --remove-orphans "$@"
}

down () {
	dc down --remove-orphans "$@"
}

logs () {
	dc logs -f "$@"
}

# Custom helpers
refresh () {
	down
	up
}

sqlcmd () {
	dc exec db /opt/mssql-tools/bin/sqlcmd \
			-U sa \
			-P Testing1122 \
			-H localhost \
			-d AssetControl \
			"$@"
}

# Core logic
main () {
	local_function="$1"
	if function_exists $1; then
		shift
		eval "$local_function" "$@"
	else
		dc "$@"
	fi
}

# Only execute main function when file is executed
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
	main "$@"
fi
